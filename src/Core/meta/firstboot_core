#!/bin/bash

#set -e

. /usr/pluto/bin/Config_Ops.sh

if [ "$FirstBoot" = "false" ] ; then
	echo "Skipping firstboot, already completed."
	exit 0
fi

. /usr/pluto/install/install-core.sh

StatsMessage "Running firstboot_core - Begin"

# run any device specific firstboot add-on scripts here
for f in /usr/pluto/install/firstboot_core_* ; do
	StatsMessage "Running script: ${f}_preinst - Begin"
	. "$f" || :
	$(basename "$f")_preinst || :
	StatsMessage "Running script: ${f}_preinst - End"
done
###########################################################
###########################################################
###########################################################

Nic_Config
Create_And_Configure_Core
Configure_Network_Options
TimeUpdate

###########################################################
###########################################################
###########################################################
# run any device specific firstboot add-on scripts here
for f in /usr/pluto/install/firstboot_core_* ; do
	StatsMessage "Running script: ${f}_postinst - Begin"
	. "$f" || :
	$(basename "$f")_postinst || :
	StatsMessage "Running script: ${f}_postinst - End"
done

StatsMessage "Running firstboot_core - End"

StatsMessage "Setting firstboot = false"
ConfSet "FirstBoot" "false"
sync

StatsMessage "Rebooting in 5 seconds"
sleep 1
StatsMessage "Rebooting in 4 seconds"
sleep 1
StatsMessage "Rebooting in 3 seconds"
sleep 1
StatsMessage "Rebooting in 2 seconds"
sleep 1
StatsMessage "Rebooting in 1 seconds"
sleep 1
StatsMessage "Rebooting"
reboot
return 0
